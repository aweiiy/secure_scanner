{% extends 'base.html' %}

{% block title %}Reports{% endblock %}

{% block content %}
<div class="container" style="margin-top: 100px;">
   <div class="row">
      <div class="col">
      </div>
      <div class="col-12">
         <div class="card">
            <div class="card-body">
                <div class="card">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Report ID</th>
                                    <th scope="col">Report Name</th>
                                    <th scope="col">Report Request Date</th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for report in reports %}
                                <tr>
                                    <td>{{ report.id }}</td>
                                    <td>{{ report.name }}</td>
                                    <td>{{ report.date }}</td>
                                    <td>
                                        <button type="button" class="btn btn-primary" onclick="window.location.href='/reports/{{ report.id }}'">View</button>
                                        <form action="/reports/{{ report.id }}/delete" method="POST" style="display: inline;">
                                            <button type="submit" class="btn btn-danger">Delete</button>
                                        </form>
                                        <button type="button" class="btn btn-primary check_button" data-task_id="{{report.task_id}}">Check status</button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
            </div>
         </div>
      </div>
      <div class="col">
      </div>
   </div>

{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        $('.check_button').click(function() {
            var task_id = $(this).data('task_id');
            $.ajax({
                url: '/reports/check_status',
                type: 'POST',
                data: {
                    task_id: task_id
                },
                success: function(data) {
                    alert(data['status']);
                }
            });
        });
    });
</script>
{% endblock %}