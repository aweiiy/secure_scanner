{% extends 'base.html' %}

{% block title %}Reports{% endblock %}

{% block content %}
<div class="container" style="margin-top: 100px;">
   <div class="row">
      <div class="col">
      </div>
      <div class="col-12">
      <nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page">Reports</li>
  </ol>
</nav>
         <div class="card">
            <div class="card-body">
                <div class="card">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Report ID</th>
                                    <th scope="col">Report Name</th>
                                    <th scope="col">Report Request Date</th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                            <tbody>
                            {% if reports|length == 0 %}
                                <tr>
                                    <td colspan="4" style="text-align: center;">No reports found</td>
                                </tr>
                            {% else %}
                                {% for report in reports %}
                                <tr>
                                    <td>{{ report.id }}</td>
                                    <td>{{ report.name }}</td>
                                    <td>{{ report.date }}</td>
                                    <td>
                                        <button type="button" class="btn btn-primary" onclick="window.location.href='/reports/{{ report.id }}'">View</button>
                                        {% if report.status == "Ready" %}
                                            <button type="button" class="btn btn-success" onclick="window.location.href='/reports/{{ report.id }}/download'">Download</button>
                                        {% else %}
                                            <button type="button" class="btn btn-outline-primary check_button" id="{{report.id}}" data-task_id="{{report.task_id}}">Check status</button>
                                        {% endif %}
                                        <form action="/reports/{{ report.id }}/delete" method="POST" style="display: inline;">
                                            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this report?')">Delete</button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                            {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
            </div>
         </div>
      </div>
      <div class="col">
      </div>
   </div>

{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        $('.check_button').click(function() {
            var task_id = $(this).data('task_id');
            $.ajax({
                url: '/reports/check_status',
                type: 'POST',
                data: {
                    task_id: task_id
                },
                success: function(data) {
                    if (data['state'] == 'SUCCESS') {
                        window.location.reload();
                    }
                    alert(data['status']);
                }
            });
        });
    });
</script>
{% endblock %}